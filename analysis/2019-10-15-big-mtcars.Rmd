---
title: "2019-10-15-big-mtcars"
author: "John Blischak"
date: "2019-10-16"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.width = 8, fig.height = 8)
```

## Introduction

Sooner rather than later I'm going to need to buy a new car. And let's face it,
it'll probably be a van. What brand of van should I buy? I explore this below
using this week's #TidyTuesday data.

**Conclusion:** I should look at Chrysler vans for saving gas and producing
fewer greenhouse gases.

* [Tweet](https://twitter.com/thomas_mock/status/1183766578397110274)
* [Description](https://github.com/rfordatascience/tidytuesday/tree/master/data/2019/2019-10-15)
* [Data](https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-10-15/big_epa_cars.csv)
* Sources: [Data dictionary](https://www.fueleconomy.gov/feg/ws/index.shtml#fuelType1), [Blog post by Ellis Hughes](https://thebioengineer.github.io/thebioengineer.github.io/2019/09/10/big-mtcars/)

## Setup

```{r pkgs, message=FALSE}
library(tidyverse)
theme_set(theme_classic(base_size = 16))
library(stringr)
```

Need to set `guess_max` to a high value so that the columns are correctly
parsed. Using on the first 1000 rows, readr erroneously guesses that some
columns are logical.

```{r data, message=FALSE}
big_epa_cars <- readr::read_csv("data/big_epa_cars.csv", guess_max = 50000)
```

## What brand of van should I buy?

The EPA's [Greenhouse Gas Rating][ghg] is a scale from 1 (worst) to 10 (best).

[ghg]: https://www.epa.gov/greenvehicles/greenhouse-gas-rating

```{r explore}
big_epa_cars %>%
  count(VClass)

summary(big_epa_cars$year)
# https://www.epa.gov/greenvehicles/greenhouse-gas-rating
mean(big_epa_cars$ghgScore == -1) # NA
summary(big_epa_cars$ghgScore[big_epa_cars$ghgScore != -1])

big_epa_cars %>%
  filter(str_detect(VClass, "[Vv]an", ),
         year > 2017) %>%
  count(make, VClass)
```

```{r subset}
vans <-  big_epa_cars %>%
  filter(str_detect(VClass, "[Vv]an"),
         year > 2017,
         ghgScore != -1) %>%
  mutate(name = str_c(make, model, year, sep = "-"),
         engine = if_else(str_detect(atvType, "[Hh]ybrid"),
                          "hybrid", "ICE", missing = "ICE")) %>%
  select(name, make, model, year, VClass, youSaveSpend, ghgScore, engine)
```


```{r vans}
p <- ggplot(vans, aes(x = youSaveSpend, y = ghgScore)) +
  geom_text(aes(label = make, color = engine), size = 5,
            position = position_jitter(width = 1, height = 1, seed = NULL)) +
  labs(x = "Gas savings over 5 years compared to average car",
       y = "(worse <--) EPA Greenhouse Gas Rating (--> better)",
       title = "What brand of van should I buy?") +
  scale_color_brewer(name = "Engine",
                     labels = c("Hybrid", "Internal Combustion"),
                     palette = "Dark2") +
  theme(legend.position = c(0.25, 0.75))
p
```

What are the 3 Chrysler vans at the top right of the graph?

```{r chrysler}
vans %>%
  mutate(name = str_c(make, model, year, sep = "-")) %>%
  filter(youSaveSpend > 0, ghgScore > 8) %>%
  select(name, youSaveSpend, ghgScore)
```

Oof. The cheapest model of a [2020 Chrysler Pacifica Hybrid][pacifica] costs
~$40K.

[pacifica]: https://www.chrysler.com/bmo.pacifica_hybrid.2019.html#/models/2020/pacifica_hybrid

Ford sells both [passenger][passenger] vans and [cargo][cargo] vans. Could the
poor performance of the Ford vans in these metrics be due to the fact that they
are all cargo vans?

[cargo]: https://www.ford.com/commercial-trucks/transit-connect-cargo-van/
[passenger]: https://www.ford.com/trucks/transit-connect-passenger-van-wagon/

```{r ford}
vans %>%
  filter(make == "Ford") %>%
  select(name, VClass, youSaveSpend, ghgScore)
```

No, they are all passenger vans.

Limiting the analysis to internal combustion engines, there is a big tie
between Chrysler, Honda, and Toyata (the graph has random jitter to be able
to read the names):

```{r ice-only}
p %+% (vans %>% filter(engine == "ICE")) + theme(legend.position = "none")
```

```{r table-top-ice}
vans %>%
  filter(engine == "ICE", youSaveSpend > -2000, ghgScore > 3) %>%
  knitr::kable()
```

And here is a full table of all the vans that were included.

```{r table}
vans %>%
  arrange(desc(youSaveSpend), desc(ghgScore)) %>%
  knitr::kable()
```
